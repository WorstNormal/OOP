package ru.nsu.gaev;

import java.util.Map;

/**
 * Абстрактный класс, представляющий математическое выражение.
 * Определяет базовые операции для всех типов выражений:
 * вычисление значения, взятие производной, упрощение и печать.
 */
public abstract class Expression {

    /**
     * Вычисляет значение выражения на основе строкового представления присваивания переменных.
     * <p>
     * Например, если выражение — {@code x + y}, а входная строка — {@code "x=3;y=2"},
     * метод сначала преобразует строку в карту переменных, а затем вычислит результат.
     * </p>
     *
     * @param assignment строка с присваиваниями переменных в формате "x=1;y=2"
     * @return результат вычисления выражения
     */
    public int eval(String assignment) {
        Map<String, Integer> map = Parser.parseAssignment(assignment);
        return eval(map);
    }

    /**
     * Вычисляет значение выражения на основе переданных значений переменных.
     *
     * @param vars отображение, где ключ — имя переменной, значение — её числовое значение
     * @return результат вычисления выражения
     */
    public abstract int eval(Map<String, Integer> vars);

    /**
     * Вычисляет производную данного выражения по заданной переменной.
     *
     * @param var имя переменной, по которой берётся производная
     * @return новое выражение, представляющее производную
     */
    public abstract Expression derivative(String var);

    /**
     * Упрощает текущее выражение.
     * Может объединять константы и устранять избыточные операции.
     *
     * @return упрощённое выражение
     */
    public abstract Expression simplify();

    /**
     * Печатает текущее выражение в стандартный поток вывода.
     */
    public void print() {
        System.out.print(this.toExpressionString());
    }

    /**
     * Возвращает строковое представление выражения.
     * Этот метод реализуется в подклассах.
     *
     * @return строковое представление выражения
     */
    protected abstract String toExpressionString();
}
